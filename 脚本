-- æ‰‹æœºæ¨ªå±ç«¯ç½—å¸ƒä¹æ€å¤šåŠŸèƒ½è„šæœ¬
-- ä¸“ä¸ºç§»åŠ¨è®¾å¤‡æ¨ªå±æ¨¡å¼ä¼˜åŒ–
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local GuiService = game:GetService("GuiService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- æ£€æµ‹è®¾å¤‡ç±»å‹
local isMobile = UserInputService.TouchEnabled
local isGamepad = UserInputService.GamepadEnabled

print("è®¾å¤‡æ£€æµ‹: ç§»åŠ¨è®¾å¤‡=" .. tostring(isMobile) .. ", æ‰‹æŸ„=" .. tostring(isGamepad))

-- å¡å¯†éªŒè¯ç³»ç»Ÿ
local correctPassword = "XC"
local isVerified = false

-- åˆ›å»ºéªŒè¯UI
local function createVerificationUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "VerificationUI"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = playerGui

    -- ä¸»éªŒè¯é¢æ¿
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "VerificationFrame"
    mainFrame.Size = UDim2.new(0, 320, 0, 280)
    mainFrame.Position = UDim2.new(0.5, -160, 0.5, -140)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.BorderSizePixel = 0
    mainFrame.Visible = true
    mainFrame.ZIndex = 10
    mainFrame.Parent = screenGui

    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame

    -- æ ‡é¢˜æ 
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, 0, 0, 50)
    titleBar.Position = UDim2.new(0, 0, 0, 0)
    titleBar.BackgroundColor3 = Color3.fromRGB(41, 128, 185)
    titleBar.BorderSizePixel = 0
    titleBar.Parent = mainFrame

    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = titleBar

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "TitleLabel"
    titleLabel.Size = UDim2.new(1, 0, 1, 0)
    titleLabel.Position = UDim2.new(0, 0, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "ğŸ”’ è„šæœ¬éªŒè¯ç³»ç»Ÿ"
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextSize = 18
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Parent = titleBar

    -- éªŒè¯è¯´æ˜
    local description = Instance.new("TextLabel")
    description.Name = "Description"
    description.Size = UDim2.new(1, -40, 0, 60)
    description.Position = UDim2.new(0, 20, 0, 60)
    description.BackgroundTransparency = 1
    description.Text = "è¯·è¾“å…¥å¡å¯†è¿›è¡ŒéªŒè¯\nå¡å¯†è·å–è¯·è”ç³»ç®¡ç†å‘˜"
    description.TextColor3 = Color3.fromRGB(200, 200, 200)
    description.TextSize = 14
    description.Font = Enum.Font.Gotham
    description.TextWrapped = true
    description.TextYAlignment = Enum.TextYAlignment.Top
    description.Parent = mainFrame

    -- å¯†ç è¾“å…¥æ¡†
    local passwordFrame = Instance.new("Frame")
    passwordFrame.Name = "PasswordFrame"
    passwordFrame.Size = UDim2.new(1, -40, 0, 50)
    passwordFrame.Position = UDim2.new(0, 20, 0, 130)
    passwordFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    passwordFrame.BorderSizePixel = 0
    passwordFrame.Parent = mainFrame

    local passwordCorner = Instance.new("UICorner")
    passwordCorner.CornerRadius = UDim.new(0, 8)
    passwordCorner.Parent = passwordFrame

    local passwordBox = Instance.new("TextBox")
    passwordBox.Name = "PasswordBox"
    passwordBox.Size = UDim2.new(1, -20, 1, -10)
    passwordBox.Position = UDim2.new(0, 10, 0, 5)
    passwordBox.BackgroundTransparency = 1
    passwordBox.Text = ""
    passwordBox.PlaceholderText = "è¯·è¾“å…¥å¡å¯†..."
    passwordBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    passwordBox.TextSize = 16
    passwordBox.Font = Enum.Font.Gotham
    passwordBox.ClearTextOnFocus = false
    passwordBox.Parent = passwordFrame

    -- éªŒè¯æŒ‰é’®
    local verifyButton = Instance.new("TextButton")
    verifyButton.Name = "VerifyButton"
    verifyButton.Size = UDim2.new(1, -40, 0, 45)
    verifyButton.Position = UDim2.new(0, 20, 0, 200)
    verifyButton.BackgroundColor3 = Color3.fromRGB(46, 204, 113)
    verifyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    verifyButton.Text = "âœ… éªŒè¯å¡å¯†"
    verifyButton.TextSize = 16
    verifyButton.Font = Enum.Font.GothamBold
    verifyButton.Parent = mainFrame

    local verifyCorner = Instance.new("UICorner")
    verifyCorner.CornerRadius = UDim.new(0, 8)
    verifyCorner.Parent = verifyButton

    -- çŠ¶æ€æç¤º
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Name = "StatusLabel"
    statusLabel.Size = UDim2.new(1, -40, 0, 30)
    statusLabel.Position = UDim2.new(0, 20, 0, 250)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "ç­‰å¾…éªŒè¯..."
    statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    statusLabel.TextSize = 14
    statusLabel.Font = Enum.Font.Gotham
    statusLabel.Parent = mainFrame

    -- éªŒè¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    verifyButton.MouseButton1Click:Connect(function()
        local inputPassword = passwordBox.Text
        if inputPassword == correctPassword then
            isVerified = true
            statusLabel.Text = "âœ… éªŒè¯æˆåŠŸï¼æ­£åœ¨åŠ è½½è„šæœ¬..."
            statusLabel.TextColor3 = Color3.fromRGB(46, 204, 113)
            
            -- æ¸å˜æ¶ˆå¤±æ•ˆæœ
            local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            local tween = TweenService:Create(mainFrame, tweenInfo, {BackgroundTransparency = 1})
            tween:Play()
            
            wait(0.5)
            screenGui:Destroy()
            
            -- éªŒè¯æˆåŠŸååŠ è½½ä¸»è„šæœ¬
            loadMainScript()
        else
            statusLabel.Text = "âŒ å¡å¯†é”™è¯¯ï¼Œè¯·é‡è¯•"
            statusLabel.TextColor3 = Color3.fromRGB(231, 76, 60)
            
            -- é”™è¯¯éœ‡åŠ¨æ•ˆæœ
            local shakeTween = TweenService:Create(mainFrame, TweenInfo.new(0.1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, 3, true), {
                Position = UDim2.new(0.5, -165, 0.5, -140)
            })
            shakeTween:Play()
        end
    end)

    -- å›è½¦é”®éªŒè¯
    passwordBox.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            verifyButton.MouseButton1Click:Execute()
        end
    end)
end

-- ä¸»è„šæœ¬åŠŸèƒ½
local function loadMainScript()
    -- ç­‰å¾…è§’è‰²åŠ è½½
    local character = player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")
    local rootPart = character:WaitForChild("HumanoidRootPart")

    -- çŠ¶æ€å˜é‡
    local flyEnabled = false
    local noclipEnabled = false
    local speedEnabled = false
    local backgroundEnabled = false
    local guiVisible = true
    local flySpeed = 30
    local walkSpeed = 16
    local originalWalkSpeed = humanoid.WalkSpeed
    local bodyVelocity, bodyGyro

    -- æ¨ªå±æ¨¡å¼æ£€æµ‹
    local function isLandscape()
        local viewportSize = workspace.CurrentCamera.ViewportSize
        return viewportSize.X > viewportSize.Y
    end

    -- åˆ›å»ºæ‰‹æœºä¼˜åŒ–æ§åˆ¶GUI
    local function createMobileGUI()
        local screenGui = Instance.new("ScreenGui")
        screenGui.Name = "MobileControlGUI"
        screenGui.ResetOnSpawn = false
        screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        screenGui.Parent = playerGui

        -- ä¸»æ§åˆ¶é¢æ¿ï¼ˆåº•éƒ¨å·¥å…·æ ï¼‰
        local mainPanel = Instance.new("Frame")
        mainPanel.Name = "MainPanel"
        mainPanel.Size = UDim2.new(1, 0, 0, 80)
        mainPanel.Position = UDim2.new(0, 0, 1, -80)
        mainPanel.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
        mainPanel.BackgroundTransparency = 0.2
        mainPanel.BorderSizePixel = 0
        mainPanel.Parent = screenGui

        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 12)
        corner.Parent = mainPanel

        -- åŠŸèƒ½æŒ‰é’®å®¹å™¨
        local buttonContainer = Instance.new("Frame")
        buttonContainer.Name = "ButtonContainer"
        buttonContainer.Size = UDim2.new(1, -40, 1, -20)
        buttonContainer.Position = UDim2.new(0, 20, 0, 10)
        buttonContainer.BackgroundTransparency = 1
        buttonContainer.Parent = mainPanel

        local uiListLayout = Instance.new("UIListLayout")
        uiListLayout.FillDirection = Enum.FillDirection.Horizontal
        uiListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
        uiListLayout.VerticalAlignment = Enum.VerticalAlignment.Center
        uiListLayout.Padding = UDim.new(0, 10)
        uiListLayout.Parent = buttonContainer

        -- åˆ›å»ºåŠŸèƒ½æŒ‰é’®å‡½æ•°
        local function createMobileButton(name, icon, color)
            local button = Instance.new("TextButton")
            button.Name = name
            button.Size = UDim2.new(0, 60, 0, 60)
            button.BackgroundColor3 = color or Color3.fromRGB(60, 60, 80)
            button.TextColor3 = Color3.fromRGB(255, 255, 255)
            button.Text = icon .. "\n" .. name
            button.TextSize = 12
            button.Font = Enum.Font.GothamBold
            button.TextWrapped = true
            button.Parent = buttonContainer

            local corner = Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 8)
            corner.Parent = button
            
            return button
        end

        -- åˆ›å»ºç§»åŠ¨ç«¯åŠŸèƒ½æŒ‰é’®
        local buttons = {
            flyButton = createMobileButton("é£è¡Œ", "ğŸš€", Color3.fromRGB(255, 87, 51)),
            noclipButton = createMobileButton("ç©¿å¢™", "ğŸ‘»", Color3.fromRGB(156, 39, 176)),
            speedButton = createMobileButton("åŠ é€Ÿ", "âš¡", Color3.fromRGB(255, 193, 7)),
            backgroundButton = createMobileButton("èƒŒæ™¯", "ğŸ¨", Color3.fromRGB(76, 175, 80)),
            hideButton = createMobileButton("éšè—", "ğŸ‘", Color3.fromRGB(33, 150, 243))
        }

        -- çŠ¶æ€æ˜¾ç¤ºæ ‡ç­¾
        local statusLabel = Instance.new("TextLabel")
        statusLabel.Name = "StatusLabel"
        statusLabel.Size = UDim2.new(0.3, 0, 1, -10)
        statusLabel.Position = UDim2.new(0.7, 0, 0, 5)
        statusLabel.BackgroundTransparency = 1
        statusLabel.Text = "è„šæœ¬å·²åŠ è½½\néªŒè¯çŠ¶æ€: âœ…"
        statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        statusLabel.TextSize = 12
        statusLabel.Font = Enum.Font.Gotham
        statusLabel.TextWrapped = true
        statusLabel.TextXAlignment = Enum.TextXAlignment.Right
        statusLabel.Parent = mainPanel

        -- åŠŸèƒ½å®ç°
        local function enableFlight()
            if not flyEnabled then
                flyEnabled = true
                bodyVelocity = Instance.new("BodyVelocity")
                bodyGyro = Instance.new("BodyGyro")
                
                bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                bodyVelocity.MaxForce = Vector3.new(40000, 40000, 40000)
                bodyVelocity.Parent = rootPart
                
                bodyGyro.MaxTorque = Vector3.new(40000, 40000, 40000)
                bodyGyro.P = 1000
                bodyGyro.D = 100
                bodyGyro.Parent = rootPart
                
                buttons.flyButton.BackgroundColor3 = Color3.fromRGB(46, 204, 113)
                statusLabel.Text = "é£è¡Œæ¨¡å¼: å¼€å¯"
            else
                flyEnabled = false
                if bodyVelocity then bodyVelocity:Destroy() end
                if bodyGyro then bodyGyro:Destroy() end
                buttons.flyButton.BackgroundColor3 = Color3.fromRGB(255, 87, 51)
                statusLabel.Text = "é£è¡Œæ¨¡å¼: å…³é—­"
            end
        end

        local function enableNoclip()
            noclipEnabled = not noclipEnabled
            if noclipEnabled then
                buttons.noclipButton.BackgroundColor3 = Color3.fromRGB(46, 204, 113)
                statusLabel.Text = "ç©¿å¢™æ¨¡å¼: å¼€å¯"
            else
                buttons.noclipButton.BackgroundColor3 = Color3.fromRGB(156, 39, 176)
                statusLabel.Text = "ç©¿å¢™æ¨¡å¼: å…³é—­"
            end
        end

        local function enableSpeed()
            speedEnabled = not speedEnabled
            if speedEnabled then
                humanoid.WalkSpeed = walkSpeed
                buttons.speedButton.BackgroundColor3 = Color3.fromRGB(46, 204, 113)
                statusLabel.Text = "åŠ é€Ÿæ¨¡å¼: å¼€å¯"
            else
                humanoid.WalkSpeed = originalWalkSpeed
                buttons.speedButton.BackgroundColor3 = Color3.fromRGB(255, 193, 7)
                statusLabel.Text = "åŠ é€Ÿæ¨¡å¼: å…³é—­"
            end
        end

        local function enableBackground()
            backgroundEnabled = not backgroundEnabled
            if backgroundEnabled then
                Lighting.Brightness = 2
                Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
                buttons.backgroundButton.BackgroundColor3 = Color3.fromRGB(46, 204, 113)
                statusLabel.Text = "èƒŒæ™¯ä¼˜åŒ–: å¼€å¯"
            else
                Lighting.Brightness = 1
                Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
                buttons.backgroundButton.BackgroundColor3 = Color3.fromRGB(76, 175, 80)
                statusLabel.Text = "èƒŒæ™¯ä¼˜åŒ–: å…³é—­"
            end
        end

        local function toggleGUI()
            guiVisible = not guiVisible
            mainPanel.Visible = guiVisible
            if guiVisible then
                buttons.hideButton.Text = "ğŸ‘\néšè—"
                statusLabel.Text = "UIé¢æ¿: æ˜¾ç¤º"
            else
                buttons.hideButton.Text = "ğŸ‘\næ˜¾ç¤º"
                statusLabel.Text = "UIé¢æ¿: éšè—"
            end
        end

        -- æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        buttons.flyButton.MouseButton1Click:Connect(enableFlight)
        buttons.noclipButton.MouseButton1Click:Connect(enableNoclip)
        buttons.speedButton.MouseButton1Click:Connect(enableSpeed)
        buttons.backgroundButton.MouseButton1Click:Connect(enableBackground)
        buttons.hideButton.MouseButton1Click:Connect(toggleGUI)

        -- ä¸»å¾ªç¯
        local connection
        connection = RunService.Stepped:Connect(function()
            -- é£è¡Œæ§åˆ¶
            if flyEnabled and bodyGyro then
                bodyGyro.CFrame = workspace.CurrentCamera.CFrame
            end

            -- ç©¿å¢™çŠ¶æ€
            if noclipEnabled and character then
                for _, child in ipairs(character:GetDescendants()) do
                    if child:IsA("BasePart") then
                        child.CanCollide = false
                    end
                end
            end

            -- å±å¹•æ–¹å‘æ£€æµ‹
            if not isLandscape() then
                statusLabel.Text = "è¯·åˆ‡æ¢åˆ°æ¨ªå±æ¨¡å¼"
            end
        end)

        -- è§’è‰²é‡ç½®å¤„ç†
        player.CharacterAdded:Connect(function(newCharacter)
            character = newCharacter
            humanoid = newCharacter:WaitForChild("Humanoid")
            rootPart = newCharacter:WaitForChild("HumanoidRootPart")
            originalWalkSpeed = humanoid.WalkSpeed
            
            -- é‡ç½®çŠ¶æ€
            flyEnabled = false
            noclipEnabled = false
            speedEnabled = false
            backgroundEnabled = false
            
            -- é‡ç½®æŒ‰é’®é¢œè‰²
            for _, button in pairs(buttons) do
                button.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
            end
            
            statusLabel.Text = "è§’è‰²å·²é‡ç½®"
        end)
    end

    -- å¯åŠ¨ç§»åŠ¨ç«¯è„šæœ¬
    if isMobile then
        createMobileGUI()
        print("ç§»åŠ¨ç«¯è„šæœ¬å·²åŠ è½½ - éªŒè¯çŠ¶æ€: âœ…")
    else
        print("æ£€æµ‹åˆ°éç§»åŠ¨è®¾å¤‡")
    end
end

-- å¯åŠ¨éªŒè¯ç³»ç»Ÿ
if not isVerified then
    createVerificationUI()
end
